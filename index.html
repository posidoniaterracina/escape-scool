<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Escape School</title>

<style>
* { margin:0; padding:0; box-sizing:border-box; }

body {
    overflow:hidden;
    background:#0f172a;
    font-family:Arial;
    touch-action:none;
}

#camera {
    width:100vw;
    height:100vh;
    overflow:hidden;
    position:relative;
}

#map {
    position:absolute;
    width:2500px;
    height:1600px;
    background:#f1f5f9;
    border:30px solid #111;
    transform-origin:0 0;
    will-change: transform;
}

/* ===== STANZE ===== */

.room {
    position:absolute;
    background:#e5e7eb;
    border:12px solid #111;
}

/* POSIZIONI */

#a1 { top:100px; left:200px; width:500px; height:300px; }
#a2 { top:120px; left:800px; width:400px; height:350px; }
#a3 { top:150px; left:1400px; width:600px; height:280px; }

#corr1 {
    position:absolute;
    top:500px;
    left:0;
    width:100%;
    height:200px;
    background:#9ca3af;
}

#a4 { top:800px; left:200px; width:600px; height:400px; }
#bagno { top:820px; left:900px; width:300px; height:250px; }
#presidenza { top:820px; left:1300px; width:700px; height:350px; }

/* ===== PORTA ===== */

.door {
    position:absolute;
    width:80px;
    height:160px;
    background:#6b4f2a;
    bottom:-12px;
    left:50%;
    transform-origin:left center;
    transform:translateX(-50%) rotateY(0deg);
    transition:transform 0.8s ease;
    cursor:pointer;
}

.door.open {
    transform:translateX(-50%) rotateY(-110deg);
}

/* effetto interno */
.door::after {
    content:"";
    position:absolute;
    right:10px;
    top:50%;
    width:10px;
    height:10px;
    background:#111;
    border-radius:50%;
}

/* profondit√† */
.room {
    perspective:800px;
}
</style>
</head>

<body>

<div id="camera">
    <div id="map">

        <div id="a1" class="room">
            <div class="door"></div>
        </div>

        <div id="a2" class="room">
            <div class="door"></div>
        </div>

        <div id="a3" class="room">
            <div class="door"></div>
        </div>

        <div id="corr1"></div>

        <div id="a4" class="room">
            <div class="door"></div>
        </div>

        <div id="bagno" class="room">
            <div class="door"></div>
        </div>

        <div id="presidenza" class="room">
            <div class="door"></div>
        </div>

    </div>
</div>

<script>
const map = document.getElementById("map");
const camera = document.getElementById("camera");

let scale = 1;
let pos = { x: -500, y: -300 };
let velocity = { x: 0, y: 0 };
let lastTouch = null;
let initialDistance = null;

/* ===== MOVIMENTO FLUIDO ===== */

function animate() {
    pos.x += velocity.x;
    pos.y += velocity.y;

    velocity.x *= 0.92;
    velocity.y *= 0.92;

    map.style.transform =
        `translate(${pos.x}px, ${pos.y}px) scale(${scale})`;

    requestAnimationFrame(animate);
}
animate();

/* DESKTOP DRAG */
camera.addEventListener("mousedown", e => {
    lastTouch = { x: e.clientX, y: e.clientY };
    camera.onmousemove = ev => {
        velocity.x = ev.clientX - lastTouch.x;
        velocity.y = ev.clientY - lastTouch.y;
        lastTouch = { x: ev.clientX, y: ev.clientY };
    };
});

window.addEventListener("mouseup", () => {
    camera.onmousemove = null;
});

/* ZOOM */
camera.addEventListener("wheel", e => {
    e.preventDefault();
    scale *= e.deltaY < 0 ? 1.1 : 0.9;
    scale = Math.min(Math.max(scale, 0.4), 3);
});

/* TOUCH */
camera.addEventListener("touchstart", e => {
    if (e.touches.length === 1) {
        lastTouch = {
            x: e.touches[0].clientX,
            y: e.touches[0].clientY
        };
    }
});

camera.addEventListener("touchmove", e => {
    e.preventDefault();
    if (e.touches.length === 1) {
        velocity.x = e.touches[0].clientX - lastTouch.x;
        velocity.y = e.touches[0].clientY - lastTouch.y;
        lastTouch = {
            x: e.touches[0].clientX,
            y: e.touches[0].clientY
        };
    }
});

/* ===== ANIMAZIONE PORTA ===== */

document.querySelectorAll(".door").forEach(door => {
    door.addEventListener("click", e => {
        e.stopPropagation();
        door.classList.add("open");

        setTimeout(() => {
            alert("Entrato nella stanza");
            door.classList.remove("open");
        }, 900);
    });
});
</script>

</body>
</html>
