<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Escape School</title>

<style>
* { margin:0; padding:0; box-sizing:border-box; }

body {
    overflow:hidden;
    background:#0f172a;
    font-family:Arial;
    touch-action:none;
}

/* CAMERA */
#camera {
    width:100vw;
    height:100vh;
    overflow:hidden;
    position:relative;
    cursor:grab;
}

/* MAPPA */
#map {
    position:absolute;
    width:2500px;
    height:1600px;
    background:#f1f5f9;
    border:30px solid #111;
    transform-origin:0 0;
}

/* STANZE */
.room {
    position:absolute;
    background:#d1d5db;
    border:10px solid #111;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:bold;
    cursor:pointer;
    transition:0.2s;
}

/* DISTRIBUZIONE */

#a1 { top:100px; left:200px; width:500px; height:300px; }
#a2 { top:120px; left:800px; width:400px; height:350px; }
#a3 { top:150px; left:1400px; width:600px; height:280px; }

#corr1 {
    position:absolute;
    top:500px;
    left:0;
    width:100%;
    height:200px;
    background:#9ca3af;
}

#a4 { top:800px; left:200px; width:600px; height:400px; }
#bagno { top:820px; left:900px; width:300px; height:250px; }
#presidenza { top:820px; left:1300px; width:700px; height:350px; }
</style>
</head>

<body>

<div id="camera">
    <div id="map">

        <div id="a1" class="room">A1</div>
        <div id="a2" class="room">A2</div>
        <div id="a3" class="room">A3</div>

        <div id="corr1"></div>

        <div id="a4" class="room">A4</div>
        <div id="bagno" class="room">WC</div>
        <div id="presidenza" class="room">PR</div>

    </div>
</div>

<script>
const map = document.getElementById("map");
const camera = document.getElementById("camera");

let scale = 1;
let pos = { x: -500, y: -300 };
let isDragging = false;
let start = { x:0, y:0 };
let initialDistance = null;

updateTransform();

/* ===== DESKTOP DRAG ===== */
camera.addEventListener("mousedown", e => {
    isDragging = true;
    start.x = e.clientX - pos.x;
    start.y = e.clientY - pos.y;
    camera.style.cursor = "grabbing";
});

window.addEventListener("mouseup", () => {
    isDragging = false;
    camera.style.cursor = "grab";
});

window.addEventListener("mousemove", e => {
    if (!isDragging) return;
    pos.x = e.clientX - start.x;
    pos.y = e.clientY - start.y;
    updateTransform();
});

/* ===== DESKTOP ZOOM ===== */
camera.addEventListener("wheel", e => {
    e.preventDefault();
    const zoom = e.deltaY < 0 ? 1.1 : 0.9;
    scale *= zoom;
    scale = Math.min(Math.max(scale, 0.4), 3);
    updateTransform();
});

/* ===== MOBILE TOUCH DRAG ===== */
camera.addEventListener("touchstart", e => {
    if (e.touches.length === 1) {
        isDragging = true;
        start.x = e.touches[0].clientX - pos.x;
        start.y = e.touches[0].clientY - pos.y;
    }

    if (e.touches.length === 2) {
        initialDistance = getDistance(e.touches[0], e.touches[1]);
    }
});

camera.addEventListener("touchmove", e => {
    e.preventDefault();

    if (e.touches.length === 1 && isDragging) {
        pos.x = e.touches[0].clientX - start.x;
        pos.y = e.touches[0].clientY - start.y;
        updateTransform();
    }

    if (e.touches.length === 2) {
        const newDistance = getDistance(e.touches[0], e.touches[1]);
        if (initialDistance) {
            let zoomFactor = newDistance / initialDistance;
            scale *= zoomFactor;
            scale = Math.min(Math.max(scale, 0.4), 3);
            initialDistance = newDistance;
            updateTransform();
        }
    }
});

camera.addEventListener("touchend", () => {
    isDragging = false;
    initialDistance = null;
});

/* ===== HELPERS ===== */
function getDistance(t1, t2) {
    return Math.hypot(
        t2.clientX - t1.clientX,
        t2.clientY - t1.clientY
    );
}

function updateTransform() {
    map.style.transform = `translate(${pos.x}px, ${pos.y}px) scale(${scale})`;
}
</script>

</body>
</html>
