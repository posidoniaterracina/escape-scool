<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Escape School</title>

<style>
* { margin:0; padding:0; box-sizing:border-box; }

body {
    background:#0f172a;
    overflow:hidden;
    font-family:Arial, sans-serif;
}

/* ===== GAME AREA ===== */

#game {
    position:relative;
    width:100vw;
    height:100vh;
    background:#111827;
    overflow:hidden;
}

/* ===== MAPPA ===== */

.tile {
    position:absolute;
}

.wall {
    background:#1f2937;
}

.floor {
    background:#374151;
}

.roomTile {
    background:#4b5563;
}

/* ===== PLAYER ===== */

#player {
    position:absolute;
    width:28px;
    height:28px;
    background:#22d3ee;
    border-radius:8px;
    transition:transform 0.05s linear;
}

/* ===== D-PAD ===== */

#dpad {
    position:absolute;
    bottom:30px;
    left:50%;
    transform:translateX(-50%);
    width:200px;
    height:200px;
}

.dbtn {
    position:absolute;
    width:60px;
    height:60px;
    background:#1f2937;
    border-radius:12px;
    display:flex;
    align-items:center;
    justify-content:center;
    color:white;
    font-size:24px;
    user-select:none;
}

.dbtn:active {
    background:#22d3ee;
}

#up { top:0; left:70px; }
#down { bottom:0; left:70px; }
#left { left:0; top:70px; }
#right { right:0; top:70px; }

</style>
</head>
<body>

<div id="game">
    <div id="player"></div>
    <div id="dpad">
        <div class="dbtn" id="up">↑</div>
        <div class="dbtn" id="down">↓</div>
        <div class="dbtn" id="left">←</div>
        <div class="dbtn" id="right">→</div>
    </div>
</div>

<script>
const game = document.getElementById("game");
const player = document.getElementById("player");

const TILE = 40;
const mapData = [
"############################",
"#............##.............#",
"#............##.............#",
"#............##.............#",
"#...........................#",
"#............#######........#",
"#...........................#",
"#......######...............#",
"#...........................#",
"#............##.............#",
"#............##.............#",
"############################"
];

let mapWidth = mapData[0].length;
let mapHeight = mapData.length;

let playerPos = { x: 2, y: 2 };
let direction = null;

/* ===== CREA MAPPA ===== */

mapData.forEach((row,y)=>{
    row.split("").forEach((cell,x)=>{
        const tile = document.createElement("div");
        tile.classList.add("tile");
        tile.style.width = TILE+"px";
        tile.style.height = TILE+"px";
        tile.style.left = x*TILE+"px";
        tile.style.top = y*TILE+"px";

        if(cell === "#") tile.classList.add("wall");
        else tile.classList.add("floor");

        game.appendChild(tile);
    });
});

updatePlayer();

/* ===== MOVIMENTO ===== */

function movePlayer() {
    if(!direction) return;

    let newX = playerPos.x;
    let newY = playerPos.y;

    if(direction === "up") newY--;
    if(direction === "down") newY++;
    if(direction === "left") newX--;
    if(direction === "right") newX++;

    if(mapData[newY][newX] !== "#") {
        playerPos.x = newX;
        playerPos.y = newY;
    }

    updatePlayer();
}

function updatePlayer() {
    player.style.left = playerPos.x * TILE + 6 + "px";
    player.style.top = playerPos.y * TILE + 6 + "px";
}

/* ===== GAME LOOP ===== */

setInterval(movePlayer, 150);

/* ===== CONTROLLI TOUCH ===== */

document.querySelectorAll(".dbtn").forEach(btn=>{
    btn.addEventListener("touchstart", ()=>{
        direction = btn.id;
    });
    btn.addEventListener("touchend", ()=>{
        direction = null;
    });
});

/* ===== CONTROLLI TASTIERA ===== */

window.addEventListener("keydown", e=>{
    if(e.key==="ArrowUp") direction="up";
    if(e.key==="ArrowDown") direction="down";
    if(e.key==="ArrowLeft") direction="left";
    if(e.key==="ArrowRight") direction="right";
});

window.addEventListener("keyup", ()=> direction=null);

</script>

</body>
</html>
